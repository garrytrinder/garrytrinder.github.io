# Azure DevOps AZ-400 Notes

## Azure Log Analytics

Integration with external IT systems such as ServiceNow, System Center, Provance and Cherwell can be configured using IT Service Management Connector ([ITSCM](https://docs.microsoft.com/en-us/azure/azure-monitor/platform/itsmc-overview))

*Azure services like Azure Log Analytics and Azure Monitor provide tools to detect, analyze, and troubleshoot problems with your Azure and non-Azure resources. But the work items related to an issue typically reside in an ITSM product or service. ITSMC provides a bi-directional connection between Azure and ITSM tools to help you resolve issues faster.*

# Azure Resource Manager (ARM) Templates

To modularize large ARM templates and improve maintainability you should use `Linked templates`. For example, you can point to individual ARM templates stored  in source control, i.e. GitHub and use to them via a URL specified in the ARM template definition. Use the templateLink property, defining the Uri and version of the template.

```json
"variables": {
        "linked-template": "https://raw.githubusercontent.com/neilpeterson/arm-deployment-demo/master/linked-tempate/artifacts/storage.json",
        "linked-template-two": "https://raw.githubusercontent.com/neilpeterson/arm-deployment-demo/master/linked-tempate/artifacts/identity.json"
    },
    "resources": [
        {
            "name": "storage",
            "type": "Microsoft.Resources/deployments",
            "apiVersion": "2019-10-01",
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "uri": "[variables('linked-template')]",
                    "contentVersion": "1.0.0.0"
                },
                "parameters": {
                    "name": {"value": "[parameters('name')]"},
                    "location": {"value": "[parameters('location')]"}
                }
            }
        },
```

In contrast, `Nested templates` enables you to store multiple templates but in a single file which is potentially harder to maintain.

## Source control

For teams new to Git and branching, it is recommended to take the approach that they should be creating feature branches for features and bug fixes.

`Azure Repos` support both centralised and decentralised version control systems, allowing teams to use either `Team Foundation Version Control (TFVC)` or `git`.

## Container Scanning

`Docker Trusted Registry` is a commercial image storage solution included in Docker Enterprise Edition, it provides security features for scanning images in your repositories and verify that they are free from vulnerabilities.

Whilst other registries do not provide scanning, you could scan for vulnerabilities in CI pipelines before publishing to a container registry. Other registries include, `Docker Registry`,`Docker Hub` and `Azure Container Registry` ([ACR](https://docs.microsoft.com/en-us/azure/container-registry/)).

## Azure Container Registry

When using a service principal name to grant access via headless authentication, the `AcrPush` role needs to be assigned to service accounts to write images to the registry.

To automate the update process of Docker images that serve as base images that are frequently updated, you should use `Azure Container Registry tasks` to rebuild images automatically when they are updated.

## Feature Flags Strategy

Implement a delivery strategy using feature flags.

1. Design the features functionality
2. Create a release strategy
3. Build the release
4. Test the feature
5. Release the feature

# Package Management

When creating a project that uses a NuGet package from a secured feed, you need to give the `Contributor` role to the build identity to access the package at run time. The permission enables any project in the build pipeline to access packages in the feed.

The same `Contributor` role can be given to the Project Collection Build Service if it is used as the build identity to access the feed.

`NuGet.config` files determine the behaviour of NuGet packages.

## WhiteSource

To ensure that companies that use open source components are using ones with approved terms and conditions, you can use WhiteSource to enable this and both a `blacklist` of automatically rejected licenses and a `whitelist` of automatically approved licenses should be defined.

To integrate Visual Studio Team Services (VSTS) with WhiteSource you need to create and configure a connection to enable WhiteSource to monitor the licenses and compliance of open source software.

## Azure Policy

Azure Policy is set of rules and policies that ensure that resources in a subscription adhere to a give configuration. You can create a policy that enforces that all resources contain a specific tag. Which is useful to ensure that resources are tagged with the team that are responsible for those resources.

## Automate container image build and testing

`Multi-step` tasks is the most efficient way to build and test container images in Azure DevOps.

## Licensing

Azure DevOps provides **five** `Basic` licenses for free, this allows access to all features except `Test Manager`.

`Basic + Test Plan` provide the additional Test Manager access on top of the standard `Basic` license.

`Stakeholder` licenses are limited to only work with work items, they cannot access code repositories.

## Publishing Code Coverage

To ensure that code coverage results are made available in the Azure Pipelines test summary fir a Java Application that uses Azure Pipelines, you can either, add a Publish code coverage results task or enable the code coverage tool in Maven.

## Branching Strategy

For a company to use trunk based development they should use feature branches, committing new code to the feature branch which can then be pushed. To merge the code into trunk, first a pull request should be created and on completion will merge changes from the feature branch into the main branch.